{% extends "base.html" %}
{% block content %}
<style>
  body {
    background: linear-gradient(180deg, #f9f9ff 0%, #eef1ff 100%);
    font-family: "Poppins", "Helvetica Neue", sans-serif;
  }
  .card {
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    background: white;
  }
</style>

<div class="container py-5">
  <div class="card p-4">
    <h2 class="text-center mb-4">üí∏ D√©penses du mois en cours</h2>

    <form method="POST" class="row g-3 align-items-center mb-4">
      <div class="col-md-3">
        <input type="text" name="category" class="form-control" placeholder="Cat√©gorie (ex: √âpicerie)" required>
      </div>

      <div class="col-md-2">
        <input type="number" step="0.01" name="amount" class="form-control" placeholder="Montant $" required>
      </div>

      <div class="col-md-3">
        <select name="shared_type" id="shared_type" class="form-select" onchange="toggleSharedRatio()">
          <option value="personal" selected>Personnelle</option>
          <option value="shared">Partag√©e</option>
        </select>
      </div>

      <div class="col-md-2" id="ratio_field" style="display:none;">
        <input type="number" step="0.01" min="0.1" max="1" name="shared_ratio" class="form-control" placeholder="Proportion (0.5 = 50%)">
      </div>

      <div class="col-md-2">
        <input type="text" name="note" class="form-control" placeholder="Note (facultatif)">
      </div>

      <div class="col-12 col-md-2 mt-2">
        <button type="submit" class="btn btn-primary w-100">Ajouter</button>
      </div>
    </form>

    <script>
      function toggleSharedRatio() {
        const type = document.getElementById("shared_type").value;
        document.getElementById("ratio_field").style.display = (type === "shared") ? "block" : "none";
      }
    </script>

    {% if expenses %}
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Date</th>
            <th>Cat√©gorie</th>
            <th>Montant ($)</th>
            <th>Type</th>
            <th>Part (%)</th>
            <th>Note</th>
          </tr>
        </thead>
        <tbody>
          {% for e in expenses %}
          <tr>
            <td>{{ e['created_at'][:10] }}</td>
            <td>{{ e['category'] }}</td>
            <td>{{ "%.2f"|format(e['amount']) }}</td>
            <td>{{ "Partag√©e" if e['shared_ratio'] < 1 else "Personnelle" }}</td>
            <td>{{ "%.0f"|format(e['shared_ratio'] * 100) }}%</td>
            <td>{{ e['note'] }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-center text-muted">Aucune d√©pense enregistr√©e pour ce mois.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
