{% extends "base.html" %}
{% set title = "Compte" %}
{% block content %}
<h2 class="mb-4">Mon compte</h2>

<!-- SECTION 1 : Informations de compte -->
<form action="{{ url_for('compte') }}" method="post" class="card p-4 shadow-sm mb-5">
  <div class="mb-3">
    <label for="net_income" class="form-label">Salaire net</label>
    <input type="number" step="0.01" class="form-control" id="net_income" name="net_income"
           value="{{ account['net_income'] if account else '' }}" required>
  </div>

  <div class="mb-3">
    <label for="pay_frequency" class="form-label">FrÃ©quence du salaire</label>
    <select class="form-select" id="pay_frequency" name="pay_frequency" required>
      <option value="">-- SÃ©lectionner --</option>
      <option value="hebdomadaire" {% if account and account['pay_frequency']=='hebdomadaire' %}selected{% endif %}>Hebdomadaire</option>
      <option value="aux 2 semaines" {% if account and account['pay_frequency']=='aux 2 semaines' %}selected{% endif %}>Aux 2 semaines</option>
      <option value="mensuel" {% if account and account['pay_frequency']=='mensuel' %}selected{% endif %}>Mensuel</option>
    </select>
  </div>

  <div class="mb-3">
    <label for="next_pay_date" class="form-label">Prochaine paie</label>
    <input type="date" class="form-control" id="next_pay_date" name="next_pay_date"
           value="{{ account['next_pay_date'] if account else '' }}">
  </div>

  <hr>

  <div class="row">
    <div class="col-md-4 mb-3">
      <label for="fixed_expenses" class="form-label">DÃ©penses fixes / mois</label>
      <input type="number" step="0.01" class="form-control" id="fixed_expenses" name="fixed_expenses"
             value="{{ account['fixed_expenses'] if account else '' }}">
    </div>
    <div class="col-md-4 mb-3">
      <label for="savings_goal" class="form-label">Objectif dâ€™Ã©pargne</label>
      <input type="number" step="0.01" class="form-control" id="savings_goal" name="savings_goal"
             value="{{ account['savings_goal'] if account else '' }}">
    </div>
    <div class="col-md-4 mb-3">
      <label for="debt_payment" class="form-label">Paiements de dettes</label>
      <input type="number" step="0.01" class="form-control" id="debt_payment" name="debt_payment"
             value="{{ account['debt_payment'] if account else '' }}">
    </div>
  </div>

  <div class="mb-3">
    <label for="notes" class="form-label">Notes</label>
    <textarea class="form-control" id="notes" name="notes" rows="3">{{ account['notes'] if account else '' }}</textarea>
  </div>

  <button type="submit" class="btn btn-primary">ğŸ’¾ Enregistrer</button>
</form>


<!-- SECTION 2 : DÃ©penses rÃ©currentes -->
<div class="card p-4 shadow-sm">
  <h4 class="mb-4">ğŸ’¼ DÃ©penses rÃ©currentes dÃ©taillÃ©es</h4>

  <form method="POST" class="row g-3 align-items-center mb-3">
    <input type="hidden" name="add_expense" value="1"> <!-- helps differentiate this form -->
    <div class="col-md-4">
      <input type="text" name="category" class="form-control" placeholder="CatÃ©gorie (ex: Loyer)" required>
    </div>
    <div class="col-md-3">
      <input type="number" step="0.01" name="amount" class="form-control" placeholder="Montant $" required>
    </div>
    <div class="col-md-4">
      <input type="text" name="note" class="form-control" placeholder="Note (facultatif)">
    </div>
    <div class="col-md-1">
      <button type="submit" class="btn btn-success w-100">â•</button>
    </div>
  </form>

  {% if fixed_expenses %}
  <table class="table table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th style="width: 30%;">CatÃ©gorie</th>
        <th style="width: 20%;">Montant ($)</th>
        <th style="width: 35%;">Note</th>
        <th class="text-end" style="width: 15%;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for e in fixed_expenses %}
      <tr>
        <td>
          <input
            type="text"
            name="category"
            class="form-control form-control-sm"
            value="{{ e['category'] }}"
            form="fixed-expense-{{ e['id'] }}"
            required
          >
        </td>
        <td>
          <input
            type="number"
            name="amount"
            class="form-control form-control-sm"
            step="0.01"
            value="{{ '%.2f'|format(e['amount']) }}"
            form="fixed-expense-{{ e['id'] }}"
            required
          >
        </td>
        <td>
          <input
            type="text"
            name="note"
            class="form-control form-control-sm"
            value="{{ e['note'] or '' }}"
            form="fixed-expense-{{ e['id'] }}"
            placeholder="Note facultative"
          >
        </td>
        <td class="text-end">
          <form id="fixed-expense-{{ e['id'] }}" method="POST" class="d-inline">
            <input type="hidden" name="expense_id" value="{{ e['id'] }}">
            <input type="hidden" name="update_expense" value="1">
          </form>
          <div class="d-flex justify-content-end gap-2">
            <button type="submit" class="btn btn-sm btn-primary" form="fixed-expense-{{ e['id'] }}">ğŸ’¾</button>
            <form method="POST" class="d-inline" onsubmit="return confirm('Supprimer cette dÃ©pense rÃ©currente ?');">
              <input type="hidden" name="expense_id" value="{{ e['id'] }}">
              <input type="hidden" name="delete_expense" value="1">
              <button type="submit" class="btn btn-sm btn-outline-danger">ğŸ—‘ï¸</button>
            </form>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="text-muted text-center">Aucune dÃ©pense rÃ©currente ajoutÃ©e.</p>
  {% endif %}
</div>
{% endblock %}
