{% extends "base.html" %}
{% set title = "Statistiques" %}
{% block styles %}
<style>
  .stats-card {
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    background: white;
  }
  .section-title {
    font-weight: 600;
    color: #4e6ef2;
  }
  .table thead {
    background-color: #eef1ff;
  }
</style>
{% endblock %}
{% block content %}
<div class="container py-5">
  <h2 class="text-center mb-5">üìä Statistiques du mois en cours</h2>

  <!-- R√©sum√© global -->
  <div class="stats-card p-4 mb-5">
    <h4 class="section-title mb-3">R√©sum√© financier</h4>
    <div class="row text-center">
      <div class="col-md-3">
        <h6>Revenu net</h6>
        <p class="fw-bold text-success">{{ "%.2f"|format(net_income) }} $</p>
      </div>
      <div class="col-md-3">
        <h6>D√©penses fixes</h6>
        <p class="fw-bold text-danger">{{ "%.2f"|format(total_fixed) }} $</p>
      </div>
      <div class="col-md-3">
        <h6>D√©penses variables</h6>
        <p class="fw-bold text-danger">{{ "%.2f"|format(total_variable) }} $</p>
      </div>
      <div class="col-md-3">
        <h6>Reste disponible</h6>
        <p class="fw-bold {% if remaining < 0 %}text-danger{% else %}text-success{% endif %}">
          {{ "%.2f"|format(remaining) }} $
        </p>
      </div>
    </div>
  </div>

  <!-- R√©partition par cat√©gorie -->
  <div class="stats-card p-4 mb-5">
    <h4 class="section-title mb-3">üìÇ R√©partition par cat√©gorie</h4>
    {% if category_breakdown %}
      <table class="table table-striped align-middle">
        <thead>
          <tr>
            <th>Cat√©gorie</th>
            <th>D√©penses fixes ($)</th>
            <th>D√©penses variables ($)</th>
            <th>Total ($)</th>
          </tr>
        </thead>
        <tbody>
          {% for row in category_breakdown %}
            <tr>
              <td>{{ row.category }}</td>
              <td>{{ "%.2f"|format(row.fixed_total) }}</td>
              <td>{{ "%.2f"|format(row.variable_total) }}</td>
              <td class="fw-semibold">{{ "%.2f"|format(row.overall_total) }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted text-center">Aucune donn√©e cat√©goris√©e pour le moment.</p>
    {% endif %}
  </div>

  <!-- D√©penses fixes -->
  <div class="stats-card p-4 mb-5">
    <h4 class="section-title mb-3">üíº D√©penses r√©currentes</h4>
    {% if fixed_expenses %}
      <table class="table table-hover align-middle">
        <thead>
          <tr><th>Cat√©gorie</th><th>Total ($)</th></tr>
        </thead>
        <tbody>
          {% for row in fixed_expenses %}
          <tr>
            <td>{{ row["category"] }}</td>
            <td>{{ "%.2f"|format(row["total"]) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted text-center">Aucune d√©pense r√©currente enregistr√©e.</p>
    {% endif %}
  </div>

  <!-- D√©penses variables -->
  <div class="stats-card p-4 mb-5">
    <h4 class="section-title mb-3">üí∏ D√©penses ponctuelles du mois</h4>
    {% if variable_expenses %}
      <table class="table table-striped align-middle">
        <thead>
          <tr><th>Cat√©gorie</th><th>Ta part ($)</th><th>Total brut ($)</th></tr>
        </thead>
        <tbody>
          {% for row in variable_expenses %}
          <tr>
            <td>{{ row["category"] }}</td>
            <td>{{ "%.2f"|format(row["total"]) }}</td>
            <td>{{ "%.2f"|format(row["total_brut"]) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted text-center">Aucune d√©pense ponctuelle enregistr√©e pour ce mois.</p>
    {% endif %}
  </div>

  <!-- Objectif d'√©pargne -->
  {% if savings_goal %}
  <div class="stats-card p-4">
    <h4 class="section-title mb-3">üéØ Objectif d‚Äô√©pargne</h4>
    <p>Montant pr√©vu : <strong>{{ "%.2f"|format(savings_goal) }} $</strong></p>
    <p>Montant restant √† √©pargner ce mois-ci :
      <strong class="{% if remaining < 0 %}text-danger{% else %}text-success{% endif %}">
        {{ "%.2f"|format(remaining if remaining > 0 else 0) }} $
      </strong>
    </p>
  </div>
  {% endif %}
</div>
{% endblock %}
